 11  REM   *******************
 13  REM   ** PLANETFALL    **
 15  REM   ** for APPLE //e **
 17  REM  
 31  REM   *********************
 33  REM   * HGR TI99/4A FONT  *
 35  REM   * T. THOMPSON, 2022 *
 37  REM   * BASED ON THE 1986 *
 39  REM   * WORK OF           *
 41  REM   * KEVIN KNOX /      *
 43  REM   * MICROSPARC INC.   *
 45  REM   *********************
 47  REM   
 49  REM   POKES:
 51  REM    8,0-1 CAPS/LOWERCASE
 53  REM    7,0-2 NORMAL, SUB, 
 55  REM     OR SUPERSCRIPT
 57  REM   
 59  PRINT  CHR$ (21): REM   80COL OFF
 61  REM   
 63  REM   RELOCATE BASIC PROG TO $4001 (16385) 
 65  REM   POKE 0 INTO $4000 BECAUSE ITS REQ 
 67  REM   
 69  IF  PEEK (104) <  > 64 THEN  POKE 104,64: POKE 103,1: POKE 16384,0: PRINT  CHR$ (4)"RUN PLANETFALL"
 71  REM   LOAD HGR OUTPUT ROUTINE
 73  PRINT  CHR$ (4)"BLOAD HRTEXT"
 75  REM   
 77  REM   LOAD INITIAL FONT (TO $08D8) 
 79  REM   
 81  PRINT  CHR$ (4)"BLOAD TI99.FON"
 83  REM   
 85  REM   PRODOS? IF SO, REDIRECT OUTPUT
 87  REM   
 89  IF  PEEK (48896) = 76 THEN  POKE 2050,216: PRINT  CHR$ (4)"PR# A$802": GOTO 100
 91  REM   
 93  REM   NOT PRODOS, SO REDIRECT OUTPUT
 95  REM   
 97  POKE 54,3: POKE 55,8
 100  REM   PLANET FALL LANDING 
 110  REM   SIMULATOR
 120  DEF  FN RD(X) =  INT (X * 100) / 100
 130 FILL = 0
 140  HGR : POKE  - 16302,0: HOME 
 150 RN =  INT ( RND (1) * 799 + 150)
 160 M$ = "PROBE SHIP SS" +  STR$ (RN):MC = 13:MR = 9: GOSUB 20000
 170 M$ = "MANUAL LANDING":MC = 14: GOSUB 20000
 180 M$ = "SEQUENCE INITIATED":MC = 12: GOSUB 20000
 190 M$ = "------------------":MC = 12: GOSUB 20000
 200  REM   
 210  GOSUB 9000
 215 ZZ =  RND ( - 1 * ( PEEK (78) + 256 *  PEEK (79)))
 220  GOSUB 8000
 230  GOSUB 2000
 240 M$ = "DO YOU WANT INSTRUCTIONS?":MC = 5:MR = 20: GOSUB 20000
 245  VTAB  PEEK (37) + 2: HTAB 5: PRINT  CHR$ (7);
 250  INPUT " (YES OR NO) ";A$
 260  IF  MID$ (A$,1,1) = "Y" OR  MID$ (A$,1,1) = "y" THEN 300
 270  IF  MID$ (A$,1,1) = "N" OR  MID$ (A$,1,1) = "n" THEN 370
 275  CALL  - 3086
 280 M$ = "YES OR NO!":MC = 16:MR = 21: GOSUB 20000
 285  GOSUB 9000
 290  GOTO 240
 300  GOSUB 3000
 310 M$ = "DO YOU UNDERSTAND THE":MC = 5:MR = 20: GOSUB 20000
 315  VTAB MR: HTAB MC: PRINT  CHR$ (7);
 320  INPUT " INSTRUCTIONS? ";A$
 330  IF  MID$ (A$,1,1) = "Y" OR  MID$ (A$,1,1) = "y" THEN 370
 340  IF  MID$ (A$,1,1) = "N" OR  MID$ (A$,1,1) = "n" THEN 300
 345  CALL  - 3086
 350 M$ = "YES OR NO!":MC = 16:MR = 21: GOSUB 20000
 355  GOSUB 9000
 360  GOTO 310
 370  CALL  - 3086
 380 M$ = "APPROACHING TARGET PLANET":MC = 8:MR = 10: GOSUB 20000
 390 M$ = "YOU HAVE MANUAL CONTROL":MC = 9:MR = 12: GOSUB 20000
 400  FOR I = 1 TO 3000
 410  NEXT 
 420  GOSUB 4000
 430  GOSUB 1000
 440 NVEL = VEL - BURN + G
 450 FUEL = FUEL - BURN
 460 HT = HT - .5 * (VEL + NVEL)
 470  IF HT <  = 0 THEN 610
 480 TIME = TIME + 1
 490 VEL = NVEL
 500  GOSUB 5000
 510  GOSUB 6000
 520  GOSUB 7000
 530  IF FUEL > 0 THEN 430
 540  IF BURN = 0 THEN 440
 550 M$ = "*** OUT OF FUEL ***"
 555 QP = 1
 560 MR = 17
 570 MC = 5
 580  GOSUB 20000
 590 BURN = 0
 600  GOTO 440
 610  CALL  - 3086:QP = 0
 620 HT = HT + .5 * (VEL + NVEL)
 630  IF BURN = G THEN 660
 640 DFTR = ( - VEL +  SQR (VEL * VEL + HT * (2 * G - 2 * BURN))) / (G - BURN)
 650  GOTO 670
 660 DFTR = HT / VEL
 670 NVEL = VEL + (G - BURN) * DFTR
 680  IF NVEL > 2 THEN 720
 690 MR = 2:MC = 12:M$ = "CONGRATULATIONS!": GOSUB 20000
 695 MC = 11:M$ = "A PERFECT LANDING!": GOSUB 20000
 700 MR = MR + 1:MC = 5:M$ = "Your license is, of course,": GOSUB 20000
 702 M$ = " renewed.": GOSUB 20000
 704 MR = MR + 1:M$ = "We are offering a bonus of": GOSUB 20000
 706 M$ = "1400 Venadian Blots (veri-": GOSUB 20000
 708 M$ = "fied) for re-enlisting.": GOSUB 20000
 710 MR = MR + 1:M$ = "We do hope you'll consider": GOSUB 20000
 715 M$ = " this generous offer.": GOSUB 20000
 720  IF  ABS (NVEL) < 4 THEN 830
 730  GOSUB 10000
 740 MR = 2:MC = 5:M$ = "PROBE SHIP SS" +  STR$ (RN) + " DESTROYED ON": GOSUB 20000
 750 M$ = "LANDING DUE TO PILOT ERROR.": GOSUB 20000
 760 MR = MR + 2:M$ = "Unfortunately,": GOSUB 20000
 765 MR = MR + 1:M$ = "irregularities in the": GOSUB 20000
 770 M$ = "insurance policy will delay": GOSUB 20000
 780 M$ = "payment of survivor's": GOSUB 20000
 790 M$ = "benefits...": GOSUB 20000
 800  FOR I = 1 TO 1000
 810  NEXT 
 820 MR = MR - 1:MC = 18:M$ = "Indefinitely.": GOSUB 20000
 830 MR = 16:MC = 5:QP = 1
 840 M$ = "TOUCHDOWN AT " +  STR$ ( FN RD(TIME + DFTR)) + " SECONDS.": GOSUB 20000
 850 M$ = "LANDING VELOCITY =" +  STR$ ( FN RD(NVEL)) + "M/SEC": GOSUB 20000
 860 M$ =  STR$ ( FN RD(FUEL)) + " UNITS OF FUEL REMAINING.": GOSUB 20000
 870 MR = 20:MC = 5: VTAB MR: HTAB MC:QP = 0: PRINT  CHR$ (7);
 880  INPUT "ANOTHER MISSION? ";A$
 890  IF  LEFT$ (A$,1) = "N" OR  LEFT$ (A$,1) = "n" THEN 930
 900  IF  LEFT$ (A$,1) = "Y" OR  LEFT$ (A$,1) = "y" THEN 220
 905  INVERSE 
 910 M$ = "YES OR NO!":MC = 16:MR = 21: GOSUB 20000
 915  NORMAL 
 920  GOSUB 9000: GOTO 870
 930  CALL  - 3086
 940  HOME 
 941  VTAB 2: HTAB 6: PRINT "PlanetFall(Original) for TI-99"
 942  HTAB 6: PRINT "by:Carol Ann Casciato and"
 943  HTAB 9: PRINT "Donald J Horsfall"
 944  VTAB 6: HTAB 6: PRINT "Apple //e port by:Ted Thompson"
 945  VTAB 8: HTAB 6: PRINT "Dedicated to:"
 946  VTAB 10: HTAB 11: PRINT "James E. Henthorn,Jr."
 947  HTAB 16: PRINT "1921--2007"
 948  VTAB 13: HTAB 9: INVERSE : PRINT "                        "
 949  HTAB 9: PRINT " -=[MISSION COMPLETE]=- "
 950  HTAB 9: PRINT "                        "
 951  VTAB 21: HTAB 9: NORMAL : PRINT "Portions of this code by"
 952  HTAB 8: PRINT "Rodger Wagner & Kevin Knox"
 955  POKE 1012,0
 960  GET K$
 970  GOTO 960
 1000  REM     GET FUEL TO BURN 
 1010 MR = 17
 1020 MC = 19
 1030  GOSUB 21000
 1040 BURN = ANS
 1050  IF BURN <  = MAXTHRUST THEN 1180
 1060 M$ = "MAXIMUM BURN IS " +  STR$ (MAXTHRUST):QP = 1
 1070 MR = 19
 1080 MC = 5
 1090  GOSUB 20000
 1100  FOR I = 1 TO 10:ZZ =  PEEK ( - 16336): NEXT 
 1110  FOR K = 1 TO 500
 1120  NEXT 
 1130 MC = 5 +  LEN (M$):MR = 19
 1140 M$ = ""
 1150 OC = 5
 1160  GOSUB 20000
 1165 QP = 0
 1170  GOTO 1010
 1180  IF BURN > 0 THEN 1210
 1190 BURN = 0
 1200  RETURN 
 1210  IF BURN < FUEL THEN 1230
 1220 BURN = FUEL
 1230  RETURN 
 2000  REM   SELECT PLANET AT RANDOM
 2010  ON  INT ( RND (1) * 5 + 1) GOSUB 2090,2180,2270,2360,2450
 2020 FUEL =  INT ((50 + ( RND (1) * 7)) * G)
 2030 OFUEL = FUEL
 2040 HT = 100 * G
 2050 OHT = HT
 2060 MAXTHRUST =  INT (6 * G)
 2070 VEL =  INT (HT / (8 *  RND (1) * 10))
 2080  RETURN 
 2090 PN$ = "MARS"
 2100 G = 3.72
 2110 SC = 5
 2120 FG = 6
 2170  RETURN 
 2180 PN$ = "CYGNUS X-1"
 2190 G = 1253
 2200 SC = 2
 2210 FG = 5
 2260  RETURN 
 2270 PN$ = "TITAN"
 2280 G = 3.24
 2290 SC = 1
 2300 FG = 2
 2350  RETURN 
 2360 PN$ = "VENUS"
 2370 G = 8.6
 2380 SC = 2
 2390 FG = 6
 2440  RETURN 
 2450 PN$ = "BERNARD IV"
 2460 G = 9.78
 2470 SC = 6
 2480 FG = 1
 2530  RETURN 
 3000  REM   EXPLAIN THE RULES
 3005  CALL  - 3086
 3010 M$ = "You are landing your space":MC = 5:MR = 4: GOSUB 20000
 3020 M$ = "probe on " + PN$ + " under": GOSUB 20000
 3030 M$ = "manual control. You take": GOSUB 20000
 3040 M$ = "control at an altitude of": GOSUB 20000
 3050 M$ =  STR$ (HT) + " meters, traveling at": GOSUB 20000
 3060 M$ =  STR$ (VEL) + " meters/second, with": GOSUB 20000
 3070 M$ =  STR$ (FUEL) + " kilos of fuel": GOSUB 20000
 3080 M$ = "remaining."
 3090 M$ = "Each second of your descent":MR = MR + 1: GOSUB 20000
 3100 M$ = "you specify the amount of": GOSUB 20000
 3110 M$ = "fuel you want to burn to": GOSUB 20000
 3120 M$ = "a maximum of " +  STR$ (MAXTHRUST) + ".": GOSUB 20000
 3130 M$ = "Don't burn too much fuel or":MR = MR + 1: GOSUB 20000
 3140 M$ = "you'll go up -- not down!": GOSUB 20000
 3150  GOSUB 9000
 3160 M$ = "You must impact the surface":MR = 4: GOSUB 20000
 3170 M$ = "at less than 2 m/sec to": GOSUB 20000
 3180 M$ = "retain your pilot's": GOSUB 20000
 3190 M$ = "license.": GOSUB 20000
 3200 M$ = "If you reach the surface":MR = MR + 2: GOSUB 20000
 3210 M$ = "travelling at more than 4": GOSUB 20000
 3220 M$ = "m/sec, your ship is": GOSUB 20000
 3230 M$ = "destroyed.": GOSUB 20000
 3240  FOR I = 1 TO 3000
 3250  NEXT 
 3260 M$ = "Oh, and so are YOU.":MR = MR + 4: GOSUB 20000
 3270  REM   
 3280  GOSUB 9000
 3290  RETURN 
 4000  REM   SETUP SCREEN DISPLAY
 4010  CALL  - 3086
 4020  HCOLOR= SC
 4030  FOR I = 0 TO 20
 4040  HPLOT I,I TO 279 - I,I TO 279 - I,191 - I TO I,191 - I TO I,I
 4050  NEXT 
 4060 C2 = 199
 4070 R1 = 24
 4140  VTAB 4: HTAB 16: PRINT "FUEL": PRINT : PRINT : HTAB 5: PRINT PN$;: HTAB 18: PRINT "GRAVITY:"; STR$ (G)
 4145  PRINT : HTAB 5
 4150  PRINT "FUEL REMAINING:"; STR$ (FUEL)
 4155  PRINT : HTAB 5
 4160  PRINT "DESCENT RATE:"; STR$ (VEL)
 4165  PRINT : HTAB 5
 4170  PRINT "TIME TO IMPACT:"; STR$ ( FN RD(HT / VEL))
 4175  PRINT : HTAB 5
 4180  PRINT "ALTITUDE:"; STR$ (HT)
 4185  PRINT : HTAB 5
 4190  PRINT "FUEL TO BURN->"
 4200  HCOLOR= 3
 4210  HPLOT 226,23 TO 226,160 TO 235,160 TO 235,23 TO 226,23
 4220  FOR I = 227 TO 234: HPLOT I,24 TO I,159: NEXT 
 4230  HCOLOR= 4: XDRAW 1 AT 230,24
 4231  HCOLOR= 3
 4232  HPLOT 27,32 TO 200,32 TO 200,39 TO 27,39 TO 27,32
 4235  HCOLOR= FG
 4240  FOR I = 28 TO 199: HPLOT I,33 TO I,38: NEXT 
 4241  RETURN 
 4250  RETURN 
 5000  REM  UPDATE THE NUMERIC DISPLAY
 5010 M$ =  STR$ (FUEL)
 5020 FILL = 5
 5030 MR = 9
 5040 MC = 20
 5050  GOSUB 20000
 5060 M$ =  STR$ ( FN RD(VEL))
 5070 FILL = 6
 5080 MR = 11
 5090 MC = 18
 5100  GOSUB 20000
 5110 M$ = "***"
 5120  IF VEL <  = 0 THEN 5140
 5130 M$ =  STR$ ( FN RD(HT / VEL))
 5140 FILL = 8
 5150 MR = 13
 5160 MC = 20
 5170  GOSUB 20000
 5180 M$ =  STR$ ( FN RD(HT))
 5190 FILL = 8
 5200 MR = 15
 5210 MC = 14
 5220  GOSUB 20000
 5230  RETURN 
 6000  REM  UPDATE FUEL GAUGE
 6010  IF F1 = 0 THEN  RETURN 
 6020 F2 =  INT (FUEL / OFUEL * 171) + 28
 6030  IF F2 = F1 THEN  RETURN 
 6040  HCOLOR= 4
 6050  FOR J = F1 TO F2 STEP  - 1
 6060  HPLOT J,33 TO J,38
 6070  NEXT 
 6080 F1 = F2
 6090  RETURN 
 7000  REM  UPDATE ALTIMETER
 7010 R2 = 151 -  INT (HT / OHT * 127)
 7020  IF R2 = R1 THEN  RETURN 
 7030  IF R2 < R1 THEN 7230
 7040  IF R2 > 151 OR R2 < 24 THEN  RETURN 
 7050  REM  MOVE ROCKET DOWN
 7060  FOR DP = R1 TO R2 - 1
 7070  XDRAW 1 AT 230,DP: XDRAW 1 AT 230,DP + 1
 7080  NEXT 
 7200 R1 = R2
 7210  RETURN 
 7220  REM  MOVE ROCKET UP
 7230  IF R1 = 24 THEN  RETURN 
 7240  FOR DP = R1 TO R2 + 1 STEP  - 1
 7250  IF DP < 25 THEN 7270
 7260  XDRAW 1 AT 230,DP: XDRAW 1 AT 230,DP - 1
 7270  NEXT 
 7280  IF R2 < 24 THEN R2 = 24
 7290 R1 = R2
 7300  RETURN 
 8000  REM  LOAD SHAPE TABLE
 8010  PRINT  CHR$ (4)"BLOAD PROBE.ICN"
 8020  POKE 232,252
 8030  POKE 233,29
 8040  SCALE= 1
 8050  ROT= 1
 8060  PRINT  CHR$ (4)"BLOAD SNDFX.GEN"
 8070  PRINT  CHR$ (4)"BLOAD NOISE.TBL"
 8080 F1 = 199
 8090 R1 = 24
 8130  RETURN 
 9000  REM  DELAY FOR KEYSTROKE
 9010  HTAB 11: VTAB 24: PRINT "HIT ANY KEY TO GO ON"
 9020  POKE  - 16368,0: GET Z$
 9030  CALL  - 3086
 9040  RETURN 
 10000  REM  CRASH!!
 10001  HOME 
 10002  FOR I = 1 TO 8
 10003  PRINT "SYSTEM FAILURE SYSTEM FAILURE SYSTEM FAI";
 10004  PRINT "LURE SYSTEM FAILURE SYSTEM FAILURE SYSTE";
 10006  PRINT "M FAILURE SYSTEM FAILURE SYSTEM FAILURE"
 10007  NEXT 
 10010  FOR L = 1 TO 4
 10020  FOR P = 255 TO 110 STEP  - 5
 10030  CALL 768,P,12
 10040  CALL 768,P - 45,12
 10050  NEXT 
 10060  FOR P = 110 TO 255 STEP 5
 10070  CALL 768,P,12
 10080  CALL 768,P - 45,12
 10090  NEXT 
 10100  NEXT 
 10110  FOR P = 46 TO 255 STEP 2
 10120  CALL 768,P,12
 10130  CALL 768,P - 45,12
 10140  NEXT 
 10145  CALL  - 3086
 10150  FOR L = 1 TO 2
 10160  FOR I = 1 TO 200 STEP 20
 10170  CALL 792,I,1
 10180  NEXT 
 10190  NEXT 
 10200  CALL 792,220,2
 10210  RETURN 
 20000  REM PRINT M$ @ MC AND MR
 20010 MLN =  LEN (M$)
 20015  IF FILL THEN M$ = M$ +  MID$ ("          ",1,FILL - MLN + 1):MLN = FILL:FILL = 0
 20020  IF MLN = 0 THEN 20100
 20030  HTAB MC: VTAB MR
 20040  FOR I = 1 TO MLN
 20050  PRINT  MID$ (M$,I,1);
 20060  IF  NOT QP AND I / 3 =  INT (I / 3) THEN ZZ =  PEEK ( - 16336)
 20070  NEXT 
 20080 MR = MR + 1
 20090  RETURN 
 20100  HTAB OC: VTAB MR: PRINT  SPC( MC - OC + 1)
 20110  RETURN 
 21000  REM  GET NUMERIC ANSWER 
 21010  VTAB MR: HTAB MC: PRINT  SPC( 6)
 21040 DIGITS = 0
 21050  POKE  - 16368,0: GET K$
 21070  VTAB MR: HTAB MC: PRINT K$;
 21090  IF  ASC (K$) > 47 AND  ASC (K$) < 58 THEN 21120
 21100  FOR I = 1 TO 10:ZZ =  PEEK ( - 16336): NEXT 
 21110  GOTO 21050
 21120 DIGITS = 1
 21130 MC = MC + 1
 21140 ANS =  VAL (K$)
 21170  POKE  - 16368,0: GET K$
 21190  IF  ASC (K$) = 13 THEN 21300
 21195  IF  ASC (K$) = 27 THEN MR = 17:MC = 19: HTAB MC: PRINT  SPC( 5): GOTO 21000
 21200  HTAB MC: PRINT K$;
 21220  IF  ASC (K$) > 47 AND  ASC (K$) < 58 THEN 21250
 21230  FOR I = 1 TO 10:ZZ =  PEEK ( - 16336): NEXT 
 21235  IF  ASC (K$) <  > 8 THEN 21170
 21236 MR = 19:MC = 5:M$ = "PRESS ESC TO CLEAR ENTRY": GOSUB 20000
 21237  FOR K = 1 TO 500: NEXT 
 21238 MC = 5 +  LEN (M$):MR = 19:M$ = "":OC = 5: GOSUB 20000
 21239 MC = 19 + DIGITS:MR = 17: VTAB MR
 21240  GOTO 21170
 21250 ANS = ANS * 10 +  VAL (K$)
 21260 MC = MC + 1
 21270 DIGITS = DIGITS + 1
 21280  IF DIGITS = 5 THEN 21300
 21290  GOTO 21170
 21300  RETURN 
